# 의약품 정보 조회 프로그램

공공데이터 포털의 의약품 정보 API를 활용하여 의약품 정보를 조회하고, 동일성분 의약품을 검색하는 프로그램입니다.

## 목차
- [주요 기능](#주요-기능)
- [설치 방법](#설치-방법)
- [사용 방법](#사용-방법)
- [명령줄 옵션](#명령줄-옵션)
- [사용 예시](#사용-예시)
- [프로그램 동작 방식](#프로그램-동작-방식)
- [출력 예시](#출력-예시)

---

## 주요 기능

### 1. 다양한 조건으로 의약품 검색
- **성분코드(gnlNmCd)**: 일반명코드로 검색
- **품목명(itmNm)**: 의약품 이름으로 검색
- **제품코드(mdsCd)**: 제품 고유 코드로 검색
- **제조업체명(mnfEntpNm)**: 제조사 이름으로 검색

### 2. 동일성분 의약품 조회
- 검색된 의약품과 동일한 성분을 가진 모든 의약품 목록 제공
- ATC 코드 매핑 데이터를 활용한 포괄적인 검색

### 3. 데이터 저장
- 조회된 의약품 데이터를 엑셀 파일로 자동 저장
- 페이지네이션을 통한 전체 데이터 수집

---

## 설치 방법

### 1. 필수 패키지 설치

```bash
pip install requests pandas openpyxl urllib3
```

### 2. API 키 설정

프로그램 실행 전에 공공데이터 포털에서 발급받은 API 키를 코드에 입력해야 합니다.

```python
KEY = "여기에_발급받은_API_키_입력"
```

---

## 사용 방법

### 기본 사용법

```bash
python drug_search.py [옵션] [검색값]
```

### 필수 요구사항
- 최소 하나의 검색 조건(`--gnlNmCd`, `--itmNm`, `--mdsCd`, `--mnfEntpNm`)을 반드시 입력해야 합니다.

---

## 명령줄 옵션

### 검색 옵션

| 옵션 | 설명 | 예시 |
|------|------|------|
| `--gnlNmCd` | 성분코드 (일반명코드) | `--gnlNmCd 250501ATB` |
| `--itmNm` | 품목명 (의약품 이름) | `--itmNm 졸피드정` |
| `--mdsCd` | 제품코드 | `--mdsCd 653006900` |
| `--mnfEntpNm` | 제조업체명 | `--mnfEntpNm 하나제약` |

### 추가 옵션

| 옵션 | 설명 | 기본값 |
|------|------|--------|
| `--no-search-identical` | 동일성분 의약품 검색 생략 | False |
| `--output` | 저장할 엑셀 파일 경로 | `drug_data_api.xlsx` |
| `--per-page` | 페이지당 조회 건수 | 1000 |
| `--help` | 도움말 표시 | - |

---

## 사용 예시

### 1. 품목명으로 검색

```bash
python drug_search.py --itmNm 졸피드정
```

**설명**: "졸피드정"이라는 품목명으로 의약품을 검색하고, 동일 성분의 모든 의약품을 조회합니다.

---

### 2. 성분코드로 검색

```bash
python drug_search.py --gnlNmCd 250501ATB
```

**설명**: 성분코드 "250501ATB"를 가진 의약품을 직접 검색합니다.

---

### 3. 제품코드로 검색

```bash
python drug_search.py --mdsCd 653006900
```

**설명**: 제품코드 "653006900"로 특정 제품을 검색합니다.

---

### 4. 제조업체명으로 검색

```bash
python drug_search.py --mnfEntpNm 건일제약
```

**설명**: "건일제약"에서 제조한 의약품 목록을 조회합니다.

---

### 5. 여러 조건 조합

```bash
python drug_search.py --itmNm 아시콘정 --mnfEntpNm 건일제약
```

**설명**: 품목명이 "아시콘정"이고 제조업체가 "건일제약"인 의약품을 검색합니다.

---

### 6. 동일성분 검색 생략

```bash
python drug_search.py --itmNm 졸피드정 --no-search-identical
```

**설명**: "졸피드정" 정보만 조회하고, 동일성분 의약품 검색은 건너뜁니다.

---

### 7. 출력 파일 경로 지정

```bash
python drug_search.py --itmNm 졸피드정 --output ./results/drug_data.xlsx
```

**설명**: 결과를 `./results/drug_data.xlsx` 파일로 저장합니다.

---

### 8. 도움말 보기

```bash
python drug_search.py --help
```

**출력**:
```
usage: drug_search.py [-h] [--gnlNmCd GNLNMCD] [--itmNm ITMNM] 
                      [--mdsCd MDSCD] [--mnfEntpNm MNFENTPNM]
                      [--no-search-identical] [--output OUTPUT] 

의약품 정보 조회 프로그램

optional arguments:
  -h, --help            show this help message and exit
  --gnlNmCd GNLNMCD     성분코드 (일반명코드)
  --itmNm ITMNM         품목명
  --mdsCd MDSCD         제품코드
  --mnfEntpNm MNFENTPNM 제조업체명
  --no-search-identical 동일성분 의약품 검색 생략
  --output OUTPUT       저장할 엑셀 파일 경로
```

---

## 프로그램 동작 방식

### 1단계: 의약품 정보 검색
- 입력된 검색 조건으로 건강보험심사평가원 API 호출
- 검색 결과 최대 5개 표시
- 첫 번째 결과의 성분코드(gnlNmCd) 추출

### 2단계: 의약품 데이터 로드
- 공공데이터 포털 API에서 ATC 코드 매핑 데이터 수집
- 페이지네이션을 통해 전체 데이터 수집
- 엑셀 파일로 자동 저장

### 3단계: 동일성분 의약품 검색
- 1단계에서 추출한 성분코드로 동일성분 의약품 필터링
- 결과를 상세하게 출력

---

## 출력 예시

### 의약품 검색 결과

```
================================================================================
의약품 검색
검색 조건: 품목명: 졸피드정
================================================================================
검색 건수: 15건

  [1] 졸피드정5밀리그램(졸피뎀타르타르산염)
      성분코드: 281700ATB
      제품코드: 200003456
      제조업체: 유한양행

  [2] 졸피드정10밀리그램(졸피뎀타르타르산염)
      성분코드: 281700ATB
      제품코드: 200003457
      제조업체: 유한양행

✅ 검색 성공!
```

### 데이터 로드 진행 상황

```
================================================================================
의약품 데이터 로드 중...
================================================================================
페이지당 조회 건수: 1000건

[페이지 1] 데이터 조회 중... 
전체 데이터 건수: 45823건
예상 페이지 수: 46페이지
✓ (1000/45823건 수집)

[페이지 2] 데이터 조회 중... ✓ (2000/45823건 수집)
[페이지 3] 데이터 조회 중... ✓ (3000/45823건 수집)
...
```

### 동일성분 의약품 결과

```
================================================================================
동일성분 검색: 281700ATB
================================================================================

동일성분 의약품 리스트 (총 24개):

  [0]
    제품코드: 200003456
    품목명: 졸피드정5밀리그램
    주성분코드: 281700ATB
    제조업체: 유한양행
    
  [1]
    제품코드: 200003457
    품목명: 졸피드정10밀리그램
    주성분코드: 281700ATB
    제조업체: 유한양행
```

---
